<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë°©êµ¬ì„ í”¼ì•„ë…¸</title>
    <style>
        body { background: #222; color: white; display: flex; flex-direction: column; align-items: center; }
        .piano-container { width: 95%; overflow-x: auto; padding: 50px 20px; background: #1a1a1a; border-radius: 10px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .piano { display: flex; position: relative; cursor: pointer; }
        
        /* í° ê±´ë°˜ ë””ìì¸ */
        .key.white { width: 40px; height: 200px; background: white; border: 1px solid #ccc; border-radius: 0 0 5px 5px; z-index: 1; }
        .key.white:active, .key.white.active { background: #e0e0e0; box-shadow: inset 0 0 10px #888; }

        /* ê²€ì€ ê±´ë°˜ ë””ìì¸ */
        .key.black { width: 26px; height: 120px; background: #000; border-radius: 0 0 3px 3px; margin-left: -13px; margin-right: -13px; z-index: 2; position: relative; }
        .key.black:active, .key.black.active { background: #333; }
        
        .label { position: absolute; bottom: 10px; width: 100%; text-align: center; color: #888; font-size: 10px; pointer-events: none; }
    </style>
</head>
<body>
    <h1>ğŸ¹ ë°©êµ¬ì„ í”¼ì•„ë…¸</h1>
    <div class="piano-container">
        <div id="piano" class="piano"></div>
    </div>

    <script>
        const piano = document.getElementById('piano');
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        // 88ê±´ë°˜ ìƒì„± (A0ë¶€í„° C8ê¹Œì§€)
        // ê²€ì€ ê±´ë°˜ì´ ìˆëŠ” ìœ„ì¹˜ íŒ¨í„´ (ë„#, ë ˆ#, íŒŒ#, ì†”#, ë¼#)
        const pattern = [0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0]; 
        
        for (let i = 0; i < 88; i++) {
            const key = document.createElement('div');
            const noteIndex = (i + 9) % 12; // A0ê°€ ì²« ë²ˆì§¸ ê±´ë°˜ì´ë¯€ë¡œ ë³´ì •
            const isBlack = pattern[noteIndex] === 1;
            
            key.className = `key ${isBlack ? 'black' : 'white'}`;
            const freq = 440 * Math.pow(2, (i - 48) / 12);
            
            key.onmousedown = () => playNote(freq, key);
            piano.appendChild(key);
        }

        function playNote(frequency, element) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(frequency, audioCtx.currentTime);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            element.classList.add('active');
            osc.start();
            gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 1.5);
            osc.stop(audioCtx.currentTime + 1.5);
            setTimeout(() => element.classList.remove('active'), 200);
        }

        // í‚¤ë³´ë“œ ì—°ì£¼ ë§¤í•‘ (ì¤‘ê°„ ë„ ë¶€ê·¼)
        const keyMap = {
            // í° ê±´ë°˜ (ì•„ë«ì¤„)
            'a': 39, // ë„ (C4)
            's': 41, // ë ˆ
            'd': 43, // ë¯¸
            'f': 44, // íŒŒ
            'g': 46, // ì†”
            'h': 48, // ë¼
            'j': 50, // ì‹œ
            'k': 51, // ë„ (C5)

            // ê²€ì€ ê±´ë°˜ (ìœ—ì¤„)
            'w': 40, // ë„#
            'e': 42, // ë ˆ#
            't': 45, // íŒŒ#
            'y': 47, // ì†”#
            'u': 49  // ë¼#
        };

        window.addEventListener('keydown', (e) => {
            if (e.repeat) return; // ê¾¹ ëˆ„ë¥´ê³  ìˆì„ ë•Œ ì†Œë¦¬ ì¤‘ë³µ ë°©ì§€
            const key = e.key.toLowerCase();
            const noteIdx = keyMap[key];
            
            if (noteIdx !== undefined) {
                const targetKey = piano.children[noteIdx];
                // ì‹¤ì œ í´ë¦­ê³¼ ë™ì¼í•œ íš¨ê³¼ë¥¼ ì£¼ê¸° ìœ„í•´ í•¨ìˆ˜ í˜¸ì¶œ
                playNote(440 * Math.pow(2, (noteIdx - 48) / 12), targetKey);
            }
        });
    </script>
</body>
</html>